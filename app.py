# -*- coding: utf-8 -*-
"""app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1pPbxylj233p_KCp0b8wXPNG5yDEg2keg
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import altair as alt
import numpy as np
import plotly.express as px
from sklearn.linear_model import LinearRegression
from sklearn.cluster import KMeans

df = pd.read_csv('streamlit_dataset.csv')

st.set_page_config(
    page_title="–ï–∫–æ–Ω–æ–º—ñ—á–Ω–∏–π –¥–∞—à–±–æ—Ä–¥",
    page_icon="üìä",
    layout="wide",
    initial_sidebar_state="expanded",
    menu_items={
        'Get Help': 'https://docs.streamlit.io/',
        'Report a bug': 'https://github.com/streamlit/streamlit/issues',
        'About': '–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤'
    }
)

# –£–≤—ñ–º–∫–Ω—É—Ç–∏ —Ç–µ–º–Ω—É —Ç–µ–º—É
alt.themes.enable("dark")

# –ë—ñ—á–Ω–∞ –ø–∞–Ω–µ–ª—å / SIDEBAR
st.sidebar.title("–ü–∞–Ω–µ–ª—å —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó")

# –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ (—á–µ—Ä–µ–∑ query params –∞–±–æ —Å–µ—Å—ñ—é)
if st.sidebar.button("–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏"):
    st.experimental_rerun()

# –§—ñ–ª—å—Ç—Ä–∏
selected_year = st.sidebar.selectbox("–û–±–µ—Ä—ñ—Ç—å —Ä—ñ–∫", sorted(df["Year"].unique()))
selected_regions = st.sidebar.multiselect("–†–µ–≥—ñ–æ–Ω–∏", df["Region"].unique(), default=df["Region"].unique())
selected_industries = st.sidebar.multiselect("–ì–∞–ª—É–∑—ñ", df["Industry"].unique(), default=df["Industry"].unique())
selected_scenario = st.sidebar.radio("–°—Ü–µ–Ω–∞—Ä—ñ–π", df["Scenario"].unique())

min_roi = st.sidebar.slider("–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π ROI", min_value=round(df["ROI"].min(), 2),
                            max_value=round(df["ROI"].max(), 2), value=0.0, step=0.05)

# –ß–µ–∫–±–æ–∫—Å–∏ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
show_map = st.sidebar.checkbox("üó∫ –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç—É –∫–æ–º–ø–∞–Ω—ñ–π")
show_scatter = st.sidebar.checkbox("üìâ –ü–æ–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ ROI vs Investment")

# –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏–π –±–ª–æ–∫
st.sidebar.markdown("---")
st.sidebar.markdown("üìò **–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è**: \n–§—ñ–ª—å—Ç—Ä—É–π—Ç–µ –¥–∞–Ω—ñ –∑–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —ñ –ø–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ –≥—Ä–∞—Ñ—ñ–∫–∏ —Ç–∞ —Ç–∞–±–ª–∏—Ü—ñ –Ω–∞ –ø–∞–Ω–µ–ª—ñ –ø—Ä–∞–≤–æ—Ä—É—á.")
st.sidebar.markdown("üë®‚Äçüíº **–ê–≤—Ç–æ—Ä**: Data Science Department")

# ---------------------------------
# üîΩ –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
# ---------------------------------

df_filtered = df[
    (df["Year"] == selected_year) &
    (df["Region"].isin(selected_regions)) &
    (df["Industry"].isin(selected_industries)) &
    (df["Scenario"] == selected_scenario) &
    (df["ROI"] >= min_roi)
]

# ---------------------------------
# üßæ –û—Å–Ω–æ–≤–Ω–∞ –ø–∞–Ω–µ–ª—å
# ---------------------------------

st.title("üìä –ï–∫–æ–Ω–æ–º—ñ—á–Ω–∏–π –¥–∞—à–±–æ—Ä–¥ –∫–æ–º–ø–∞–Ω—ñ–π")
st.subheader(f"üîç –í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {df_filtered.shape[0]} –∫–æ–º–ø–∞–Ω—ñ–π")

# –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è CSV
csv = df_filtered.to_csv(index=False).encode("utf-8")
st.download_button(
    label="‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV",
    data=csv,
    file_name="filtered_companies.csv",
    mime="text/csv"
)

# –¢–∞–±–ª–∏—Ü—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
st.dataframe(df_filtered)

# –ö–∞—Ä—Ç–∞ –∫–æ–º–ø–∞–Ω—ñ–π
if show_map:
    st.subheader("üó∫ –ì–µ–æ–≥—Ä–∞—Ñ—ñ—è –∫–æ–º–ø–∞–Ω—ñ–π")
    st.map(df_filtered[['Latitude', 'Longitude']])

# Scatter-–≥—Ä–∞—Ñ—ñ–∫ ROI ~ Investment
if show_scatter:
    st.subheader("üìâ ROI ~ Investment (Altair)")
    chart = alt.Chart(df_filtered).mark_circle(size=60).encode(
        x='Investment:Q',
        y='ROI:Q',
        color='Industry:N',
        tooltip=['Company', 'Investment', 'ROI']
    ).interactive().properties(
        width=700, height=400
    )
    st.altair_chart(chart, use_container_width=True)
